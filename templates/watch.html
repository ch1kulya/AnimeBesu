<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Watch {{ movie.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="text-gray-700">
    <h1 class="text-center text-4xl font-bold my-8 gradient-text">{{ movie.title }}</h1>
    <div class="flex justify-center">
        <video id="video" controls class="shadow-lg rounded-lg max-w-screen-lg min-w-screen-sm mx-4" poster="{{ movie.poster }}"></video>
    </div>
    <script>
        var video = document.getElementById('video');
        var videoUrl = '{{ movie.video_url }}';

        if (videoUrl.endsWith('.m3u8')) {
            // Условие, когда ссылка является потоком
            if (Hls.isSupported()) {
                var hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    video.play();
                });
            }
            // Если поток не поддерживается, используем прямое воспроизведение через тег video
            else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                video.src = videoUrl;
                video.addEventListener('loadedmetadata', function() {
                    video.play();
                });
            }
        } else if (videoUrl.endsWith('.mp4')) {
            // Условие, когда ссылка - это прямая ссылка на MP4 файл
            video.src = videoUrl;
            video.play();
        }
    </script>
    <div class="text-center mt-8">
        <a href="{{ url_for('index') }}" class="footer-text gradient-text">return</a>
    </div>
</body>
</html>
